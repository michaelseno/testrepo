'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _desired = require('../../desired');

var _helpersSession = require('../../helpers/session');

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

var atv = 'android.widget.TextView';
var f = "android.widget.FrameLayout";

describe('Find - xpath', function () {
  var _this = this;

  var driver = undefined;
  before(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _helpersSession.initDriver)(_desired.APIDEMOS_CAPS));

        case 2:
          driver = context$2$0.sent;

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  after(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.deleteSession());

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find element by type', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElOrEls('xpath', '//' + atv, false));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.getText(el.ELEMENT).should.eventually.equal('API Demos'));

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find element by text', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElOrEls('xpath', '//' + atv + '[@text=\'Accessibility\']', false));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.getText(el.ELEMENT).should.eventually.equal('Accessibility'));

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find element by attribute', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElOrEls('xpath', '//*[@enabled=\'true\' and @focused=\'true\']', true).should.eventually.have.length(1));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find exactly one element via elementsByXPath', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElOrEls('xpath', '//' + atv + '[@text=\'Accessibility\']', true));

        case 2:
          el = context$2$0.sent;

          el.length.should.equal(1);
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(driver.getText(el[0].ELEMENT).should.eventually.equal('Accessibility'));

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find element by partial text', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElOrEls('xpath', '//' + atv + '[contains(@text, \'Accessibility\')]', false));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.getText(el.ELEMENT).should.eventually.equal('Accessibility'));

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find the last element', function callee$1$0() {
    var el, text;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElOrEls('xpath', '(//' + atv + ')[last()]', false));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.getText(el.ELEMENT));

        case 5:
          text = context$2$0.sent;

          ["OS", "Text", "Views", "Preference"].should.include(text);

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find element by index and embedded desc', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElOrEls('xpath', '//' + f + '//' + atv + '[5]', false));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.getText(el.ELEMENT).should.eventually.equal('Content'));

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find all elements', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElOrEls('xpath', '//*', true));

        case 2:
          el = context$2$0.sent;

          el.length.should.be.above(2);

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find the first element when searching for all elements', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElOrEls('xpath', '//*', true));

        case 2:
          el = context$2$0.sent;

          el[0].should.exist;

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find less elements with compression turned on', function callee$1$0() {
    var elementsWithoutCompression, elementsWithCompression;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.updateSettings({ "ignoreUnimportantViews": false }));

        case 2:
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap(driver.findElOrEls('xpath', '//*', true));

        case 4:
          elementsWithoutCompression = context$2$0.sent;
          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(driver.updateSettings({ "ignoreUnimportantViews": true }));

        case 7:
          context$2$0.next = 9;
          return _regeneratorRuntime.awrap(driver.findElOrEls('xpath', '//*', true));

        case 9:
          elementsWithCompression = context$2$0.sent;

          elementsWithoutCompression.length.should.be.greaterThan(elementsWithCompression.length);

        case 11:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find toast message element by text @skip-ci', function callee$1$0() {
    var popUp, popUpEl, search, add;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.startActivity('io.appium.android.apis', '.view.PopupMenu1'));

        case 2:
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap(driver.implicitWait(20000));

        case 4:
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(driver.findElOrEls('accessibility id', 'Make a Popup!', false));

        case 6:
          popUp = context$2$0.sent;
          popUpEl = popUp.ELEMENT;
          context$2$0.next = 10;
          return _regeneratorRuntime.awrap(driver.click(popUpEl));

        case 10:
          context$2$0.next = 12;
          return _regeneratorRuntime.awrap(driver.findElOrEls('xpath', './/*[@text=\'Search\']', false));

        case 12:
          search = context$2$0.sent;
          context$2$0.next = 15;
          return _regeneratorRuntime.awrap(driver.click(search.ELEMENT));

        case 15:
          context$2$0.next = 17;
          return _regeneratorRuntime.awrap(driver.findElOrEls('xpath', '//*[@text=\'Clicked popup menu item Search\']', false).should.eventually.exist);

        case 17:
          context$2$0.next = 19;
          return _regeneratorRuntime.awrap(driver.click(popUpEl));

        case 19:
          context$2$0.next = 21;
          return _regeneratorRuntime.awrap(driver.findElOrEls('xpath', './/*[@text=\'Add\']', false));

        case 21:
          add = context$2$0.sent;
          context$2$0.next = 24;
          return _regeneratorRuntime.awrap(driver.click(add.ELEMENT));

        case 24:
          context$2$0.next = 26;
          return _regeneratorRuntime.awrap(driver.findElOrEls('xpath', '//*[@text=\'Clicked popup menu item Add\']', false).should.eventually.exist);

        case 26:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
});

// skip on travis, as it is too slow and the message is removed before
// we can find it
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZnVuY3Rpb25hbC9jb21tYW5kcy9maW5kL2J5LXhwYXRoLWUyZS1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7b0JBQWlCLE1BQU07Ozs7OEJBQ0ksa0JBQWtCOzs7O3VCQUNmLGVBQWU7OzhCQUNsQix1QkFBdUI7O0FBR2xELGtCQUFLLE1BQU0sRUFBRSxDQUFDO0FBQ2Qsa0JBQUssR0FBRyw2QkFBZ0IsQ0FBQzs7QUFFekIsSUFBTSxHQUFHLEdBQUcseUJBQXlCLENBQUM7QUFDdEMsSUFBTSxDQUFDLEdBQUcsNEJBQTRCLENBQUM7O0FBRXZDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsWUFBWTs7O0FBQ25DLE1BQUksTUFBTSxZQUFBLENBQUM7QUFDWCxRQUFNLENBQUM7Ozs7OzJDQUNVLHVEQUF5Qjs7O0FBQXhDLGdCQUFNOzs7Ozs7O0dBQ1AsQ0FBQyxDQUFDO0FBQ0gsT0FBSyxDQUFDOzs7OzsyQ0FDRSxNQUFNLENBQUMsYUFBYSxFQUFFOzs7Ozs7O0dBQzdCLENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQyw2QkFBNkIsRUFBRTtRQUM1QixFQUFFOzs7OzsyQ0FBUyxNQUFNLENBQUMsV0FBVyxDQUFDLE9BQU8sU0FBTyxHQUFHLEVBQUksS0FBSyxDQUFDOzs7QUFBekQsWUFBRTs7MkNBQ0EsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDOzs7Ozs7O0dBQ3RFLENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQyw2QkFBNkIsRUFBRTtRQUM1QixFQUFFOzs7OzsyQ0FBUyxNQUFNLENBQUMsV0FBVyxDQUFDLE9BQU8sU0FBTyxHQUFHLGdDQUEyQixLQUFLLENBQUM7OztBQUFoRixZQUFFOzsyQ0FDQSxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FB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REFBOEMsS0FBSyxDQUFDLENBQy9FLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBSzs7Ozs7OztHQUM3QixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9mdW5jdGlvbmFsL2NvbW1hbmRzL2ZpbmQvYnkteHBhdGgtZTJlLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5pbXBvcnQgeyBBUElERU1PU19DQVBTIH0gZnJvbSAnLi4vLi4vZGVzaXJlZCc7XG5pbXBvcnQgeyBpbml0RHJpdmVyIH0gZnJvbSAnLi4vLi4vaGVscGVycy9zZXNzaW9uJztcblxuXG5jaGFpLnNob3VsZCgpO1xuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5jb25zdCBhdHYgPSAnYW5kcm9pZC53aWRnZXQuVGV4dFZpZXcnO1xuY29uc3QgZiA9IFwiYW5kcm9pZC53aWRnZXQuRnJhbWVMYXlvdXRcIjtcblxuZGVzY3JpYmUoJ0ZpbmQgLSB4cGF0aCcsIGZ1bmN0aW9uICgpIHtcbiAgbGV0IGRyaXZlcjtcbiAgYmVmb3JlKGFzeW5jICgpID0+IHtcbiAgICBkcml2ZXIgPSBhd2FpdCBpbml0RHJpdmVyKEFQSURFTU9TX0NBUFMpO1xuICB9KTtcbiAgYWZ0ZXIoYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGRyaXZlci5kZWxldGVTZXNzaW9uKCk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGZpbmQgZWxlbWVudCBieSB0eXBlJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5maW5kRWxPckVscygneHBhdGgnLCBgLy8ke2F0dn1gLCBmYWxzZSk7XG4gICAgYXdhaXQgZHJpdmVyLmdldFRleHQoZWwuRUxFTUVOVCkuc2hvdWxkLmV2ZW50dWFsbHkuZXF1YWwoJ0FQSSBEZW1vcycpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBmaW5kIGVsZW1lbnQgYnkgdGV4dCcsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsT3JFbHMoJ3hwYXRoJywgYC8vJHthdHZ9W0B0ZXh0PSdBY2Nlc3NpYmlsaXR5J11gLCBmYWxzZSk7XG4gICAgYXdhaXQgZHJpdmVyLmdldFRleHQoZWwuRUxFTUVOVCkuc2hvdWxkLmV2ZW50dWFsbHkuZXF1YWwoJ0FjY2Vzc2liaWxpdHknKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgZmluZCBlbGVtZW50IGJ5IGF0dHJpYnV0ZScsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBkcml2ZXIuZmluZEVsT3JFbHMoJ3hwYXRoJywgYC8vKltAZW5hYmxlZD0ndHJ1ZScgYW5kIEBmb2N1c2VkPSd0cnVlJ11gLCB0cnVlKVxuICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmhhdmUubGVuZ3RoKDEpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBmaW5kIGV4YWN0bHkgb25lIGVsZW1lbnQgdmlhIGVsZW1lbnRzQnlYUGF0aCcsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsT3JFbHMoJ3hwYXRoJywgYC8vJHthdHZ9W0B0ZXh0PSdBY2Nlc3NpYmlsaXR5J11gLCB0cnVlKTtcbiAgICBlbC5sZW5ndGguc2hvdWxkLmVxdWFsKDEpO1xuICAgIGF3YWl0IGRyaXZlci5nZXRUZXh0KGVsWzBdLkVMRU1FTlQpLnNob3VsZC5ldmVudHVhbGx5LmVxdWFsKCdBY2Nlc3NpYmlsaXR5Jyk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGZpbmQgZWxlbWVudCBieSBwYXJ0aWFsIHRleHQnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmZpbmRFbE9yRWxzKCd4cGF0aCcsIGAvLyR7YXR2fVtjb250YWlucyhAdGV4dCwgJ0FjY2Vzc2liaWxpdHknKV1gLCBmYWxzZSk7XG4gICAgYXdhaXQgZHJpdmVyLmdldFRleHQoZWwuRUxFTUVOVCkuc2hvdWxkLmV2ZW50dWFsbHkuZXF1YWwoJ0FjY2Vzc2liaWxpdHknKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgZmluZCB0aGUgbGFzdCBlbGVtZW50JywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5maW5kRWxPckVscygneHBhdGgnLCBgKC8vJHthdHZ9KVtsYXN0KCldYCwgZmFsc2UpO1xuICAgIGxldCB0ZXh0ID0gYXdhaXQgZHJpdmVyLmdldFRleHQoZWwuRUxFTUVOVCk7XG4gICAgW1wiT1NcIiwgXCJUZXh0XCIsIFwiVmlld3NcIiwgXCJQcmVmZXJlbmNlXCJdLnNob3VsZC5pbmNsdWRlKHRleHQpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBmaW5kIGVsZW1lbnQgYnkgaW5kZXggYW5kIGVtYmVkZGVkIGRlc2MnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmZpbmRFbE9yRWxzKCd4cGF0aCcsIGAvLyR7Zn0vLyR7YXR2fVs1XWAsIGZhbHNlKTtcbiAgICBhd2FpdCBkcml2ZXIuZ2V0VGV4dChlbC5FTEVNRU5UKS5zaG91bGQuZXZlbnR1YWxseS5lcXVhbCgnQ29udGVudCcpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBmaW5kIGFsbCBlbGVtZW50cycsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsT3JFbHMoJ3hwYXRoJywgYC8vKmAsIHRydWUpO1xuICAgIGVsLmxlbmd0aC5zaG91bGQuYmUuYWJvdmUoMik7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGZpbmQgdGhlIGZpcnN0IGVsZW1lbnQgd2hlbiBzZWFyY2hpbmcgZm9yIGFsbCBlbGVtZW50cycsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsT3JFbHMoJ3hwYXRoJywgYC8vKmAsIHRydWUpO1xuICAgIGVsWzBdLnNob3VsZC5leGlzdDtcbiAgfSk7XG4gIGl0KCdzaG91bGQgZmluZCBsZXNzIGVsZW1lbnRzIHdpdGggY29tcHJlc3Npb24gdHVybmVkIG9uJywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGRyaXZlci51cGRhdGVTZXR0aW5ncyh7XCJpZ25vcmVVbmltcG9ydGFudFZpZXdzXCI6IGZhbHNlfSk7XG4gICAgbGV0IGVsZW1lbnRzV2l0aG91dENvbXByZXNzaW9uID0gYXdhaXQgZHJpdmVyLmZpbmRFbE9yRWxzKCd4cGF0aCcsIGAvLypgLCB0cnVlKTtcbiAgICBhd2FpdCBkcml2ZXIudXBkYXRlU2V0dGluZ3Moe1wiaWdub3JlVW5pbXBvcnRhbnRWaWV3c1wiOiB0cnVlfSk7XG4gICAgbGV0IGVsZW1lbnRzV2l0aENvbXByZXNzaW9uID0gYXdhaXQgZHJpdmVyLmZpbmRFbE9yRWxzKCd4cGF0aCcsIGAvLypgLCB0cnVlKTtcbiAgICBlbGVtZW50c1dpdGhvdXRDb21wcmVzc2lvbi5sZW5ndGguc2hvdWxkLmJlLmdyZWF0ZXJUaGFuKGVsZW1lbnRzV2l0aENvbXByZXNzaW9uLmxlbmd0aCk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGZpbmQgdG9hc3QgbWVzc2FnZSBlbGVtZW50IGJ5IHRleHQgQHNraXAtY2knLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgLy8gc2tpcCBvbiB0cmF2aXMsIGFzIGl0IGlzIHRvbyBzbG93IGFuZCB0aGUgbWVzc2FnZSBpcyByZW1vdmVkIGJlZm9yZVxuICAgIC8vIHdlIGNhbiBmaW5kIGl0XG5cbiAgICBhd2FpdCBkcml2ZXIuc3RhcnRBY3Rpdml0eShgaW8uYXBwaXVtLmFuZHJvaWQuYXBpc2AsIGAudmlldy5Qb3B1cE1lbnUxYCk7XG4gICAgYXdhaXQgZHJpdmVyLmltcGxpY2l0V2FpdCgyMDAwMCk7XG4gICAgbGV0IHBvcFVwID0gYXdhaXQgZHJpdmVyLmZpbmRFbE9yRWxzKCdhY2Nlc3NpYmlsaXR5IGlkJywgJ01ha2UgYSBQb3B1cCEnLCBmYWxzZSk7XG4gICAgbGV0ICBwb3BVcEVsID0gcG9wVXAuRUxFTUVOVDtcblxuICAgIGF3YWl0IGRyaXZlci5jbGljayhwb3BVcEVsKTtcbiAgICBsZXQgc2VhcmNoID0gYXdhaXQgZHJpdmVyLmZpbmRFbE9yRWxzKCd4cGF0aCcsIGAuLy8qW0B0ZXh0PSdTZWFyY2gnXWAsIGZhbHNlKTtcbiAgICBhd2FpdCBkcml2ZXIuY2xpY2soc2VhcmNoLkVMRU1FTlQpO1xuICAgIGF3YWl0IGRyaXZlci5maW5kRWxPckVscygneHBhdGgnLCBgLy8qW0B0ZXh0PSdDbGlja2VkIHBvcHVwIG1lbnUgaXRlbSBTZWFyY2gnXWAsIGZhbHNlKVxuICAgICAgICAuc2hvdWxkLmV2ZW50dWFsbHkuZXhpc3Q7XG5cbiAgICBhd2FpdCBkcml2ZXIuY2xpY2socG9wVXBFbCk7XG4gICAgbGV0IGFkZCA9YXdhaXQgZHJpdmVyLmZpbmRFbE9yRWxzKCd4cGF0aCcsIGAuLy8qW0B0ZXh0PSdBZGQnXWAsIGZhbHNlKTtcbiAgICBhd2FpdCBkcml2ZXIuY2xpY2soYWRkLkVMRU1FTlQpO1xuICAgIGF3YWl0IGRyaXZlci5maW5kRWxPckVscygneHBhdGgnLCBgLy8qW0B0ZXh0PSdDbGlja2VkIHBvcHVwIG1lbnUgaXRlbSBBZGQnXWAsIGZhbHNlKVxuICAgICAgICAuc2hvdWxkLmV2ZW50dWFsbHkuZXhpc3Q7XG4gIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uLy4uLy4uIn0=
